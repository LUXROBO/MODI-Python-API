<!doctype html>
<html>
<head>
<meta name="description" content="Brython">
<meta name="keywords" content="Python,Brython">
<meta name="author" content="Pierre Quentel">
<meta charset="utf-8">

<style>
#content{
    float: right;
    width: 75%;
}
#menu{
    padding-left:1%;
    margin-right: 80%;
    position: fixed;
}
</style>

<link rel="icon" type="image/png" href="favicon.png" />

<noscript>Please enable Javascript to view this page correctly.</noscript>

<script type="text/javascript" src="/src/brython.js"></script>

<script src="/assets/header.brython.js"></script>


<script type="text/python3">
from browser import document, highlight, html
import html_parser
import header

tutorial_languages = header.languages.extend(
  [["br", "Brezhoneg"],
   ["it", "Italiano"],
   ["pt-br", "Portuguese (Br.)"]
  ])

qs_lang, language = header.show(tutorial_languages)

# Highlight Python code
for elt in document.get(selector='.python'):
    src = elt.text.strip()
    h = highlight.highlight(src)
    h.className = "pycode"
    elt.clear()
    elt <= h

# Generate menu
menu = document["menu"]
for i, tag in enumerate(document.select("H1")):
    menu <= html.A(tag.text, href=f"#item{i}") + html.BR()
    tag.parent.insertBefore(html.A(name=f"item{i}"), tag)
for elt in document.select('.xml'):
    text = elt.text
    elt.text = ""
    script = False
    for item in html_parser.tokenize(text):
        if item.nodeType == html_parser.TEXT_NODE and item.text:
            if script and item.text.strip():
                h = highlight.highlight(item.text.strip())
                h.style.margin = 0
                h.classList.add("pycode")
                h.style.display = "block"
                elt <= h
            else:
                elt <= item.text
        elif item.nodeType == html_parser.ELEMENT_NODE:
            script = item.tagName == "SCRIPT" and not item.closing
            if item.closing:
                tag = item.text[1:len(item.tagName) + 2]
                attrs = item.text[len(item.tagName) + 2:-1]
            else:
                tag = item.text[1:len(item.tagName) + 1]
                attrs = item.text[len(item.tagName) + 1:-1]

            elt <= (html.SPAN("&lt;" + tag, Class="html-tag") +
                    html.SPAN(attrs, Class="html-attrs") +
                    html.SPAN("&gt;", Class="html-tag"))
</script>

<title>Brython</title>
<link rel="stylesheet" href="/brython.css">
</head>

<body onload="brython(1)">

<div id="banner_row">
<span class="logo"><a href="/index.html">brython</a></span>
</div>


<div id="content">
<p>Questo tutorial spiega come sviluppare un'applicazione eseguibile in un browser scritta con il linguaggio di programmazione Python. Faremo un esempio sviluppando una calcolatrice.
<p></p>
Ti servirà un editor di testo e, ovviamente, un browser con accesso ad internet.
<p></p>
Gli aspetti coperti in questo tutorial prevedono che tu abbia almeno conoscenze di base di HTML (composizione di una pagina HTML, tags più comuni), dei fogli di stile (CSS) and the linguaggio Python.
<p></p>
Nell'editor di testo, crea una pagina HTML con il seguente contenuto:
<p></p></p><pre class="xml">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/brython@3.9.1/brython.min.js"&gt;
    &lt;/script&gt;
&lt;/head&gt;

&lt;body onload="brython()"&gt;

&lt;script type="text/python"&gt;
from browser import document

document &lt;= "Hello !"
&lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</pre>
<p>In una cartella vuota, salva la pagina come <B><code>index.html</code></B>. Ci sono due possibilità per visualizzarlo ne browser:
<p></p>
<ul>
<li> usa il comando File/Open del tuo browser: è la soluzione più semplice. Comporta <a href="/static_doc/en/file_or_http.html">alcune limitazioni</a> nel caso di un utilizzo avanzato, ma funziona alla perfezione per questo tutorial.
<li> avvia un server web: per esempio, se il interprete Python che puoi scaricare dal sito python.org è installato, esegui il comando <code>python -m http.server</code> nella cartella in cui è presente il file index.html. Poi inserisci <I>localhost:8000/index.html</I> nella barra degli indirizzi del browser.
</ul>
<p></p>
Quando la pagina si aprirà, dovresti vedere il messaggio "Hello !" all'interno del browser.
<p></p>
<p></p>
<H1>Composizione della pagina</H1>

<p></p>
Ora diamo un'occhiata al contenuto della pagina. Nella sezione <code>&lt;head&gt;</code> viene caricato lo script <B><code>brython.js</code></B>: è questo l'engine di Brython, il programma che trova ed esegue gli script Python inclusi nella pagina. In questo esempio Brython viene scaricato online da un CDN, quindi non si deve installare nulla sul PC. Nota il numero di versione (<code>brython@3.9.1</code>): lo puoi aggiornare ad ogni nuova versione di Brython.
<p></p>
Il tag <code>&lt;body&gt;</code> contiene l'attributo <code>onload="brython()"</code>. Significa che quando la pagina ha finito di caricarsi, il browser deve chiamare la funzione <code>brython()</code>, che è definita nell'engine Brython descritto poco sopra. Questa funzione cerca tutti i tag <code>&lt;script&gt;</code> che hanno l'attributo <code>type="text/python"</code> e li esegue.
<p></p>
La nostra pagina <B><code>index.html</code></B> contiene proprio uno di questi script:
<p></p></p><pre class="python">from browser import document

document &lt;= "Hello !"</pre>
<p><p></p>
Questo è un programma standard scritto in Python, comincia importando un modulo: <B><code>browser</code></B> (in questo caso un modulo incluso nell'engine Brython <B><code>brython.js</code></B>). Questo modulo ha un attributo <code>document</code> che si riferisce al contenuto mostrato nella finestra del browser.
<p></p>
Per aggiungere del testo al documento, o in pratica per mostrare testo nel browser, la sintassi usata da Brython è
<p></p></p><pre class="python">document &lt;= "Hello !"</pre>
<p><p></p>
Puoi pensare al segno <code>&lt;=</code> come a una freccia rivolta a sinistra: il documento "riceve" un nuovo elemento, la stringa "Hello !". Vedrai nella pagina di esempio, che è sempre possibile usare la sintassi standard DOM per interagire con la pagina, ma Brython fornisce alcune scorciatoie per rendere il codice più compatto.
<p></p>
<p></p>
<H1>Formattare del testo usando tags HTML</H1>

I tag HTML permettono, ad esempio, di formattare il testo per scrivere in grassetto (tag <code>&lt;B&gt;</code>), in corsivo (tag <code>&lt;I&gt;</code>), ecc.
<p></p>
Con Brython questi tag sono disponibili come funzioni definite nel modulo <B><code>html</code></B> del pacchetto <B><code>browser</code></B>. Ecco come usarli:
<p></p></p><pre class="python">from browser import document, html

document &lt;= html.B("Hello !")</pre>
<p><p></p>
I tag si possono annidare:
<p></p></p><pre class="python">document &lt;= html.B(html.I("Hello !"))</pre>
<p><p></p>
I tag si possono anche sommare tra di loro, come anche con le stringe:
<p></p></p><pre class="python">document &lt;= html.B("Hello, ") + "world !"</pre>
<p><p></p>
Il primo parametro di una funzione-tag può essere una stringa, un numero, oppure un altro tag. Può anche essere un qualsiasi elemento Python purchè sia 'iterabile' (list comprehension, generator): in questo caso tutti gli elementi generati dell'elemento iterabile verranno aggiunti al tag:
<p></p></p><pre class="python">document &lt;= html.UL(html.LI(i) for i in range(5))</pre>
<p><p></p>
Gli attributi dei tag vengono passati come "keyword argument" alla funzione:
<p></p></p><pre class="python">html.A("Brython", href="http://brython.info")</pre>
<p><p></p>
<p></p>
<H1>Disegnamo la calcolatrice</H1>

Ora possiamo disegnare la calcolatrice come una tabella HTML.
<p></p>
La prima riga contiere il campo del risultato, seguito da un pulsante di reset. Le tre righe seguenti contengono i pulsanti dei numeri, degli operatori, virgola e uguale.
<p></p></p><pre class="python">from browser import document, html

calc = html.TABLE()
calc &lt;= html.TR(html.TH(html.DIV("0", id="result"), colspan=3) +
                html.TD("C", id="clear"))
lines = ["789/",
         "456&#42;",
         "123-",
         "0.=+"]

calc &lt;= (html.TR(html.TD(x) for x in line) for line in lines)

document &lt;= calc</pre>
<p><p></p>
Nota l'uso dei generatori per ridurre la dimensione del programma, mantenendolo nel contempo leggibile.
<p></p>
Aggiungiamo un po' di stile al tag <code>&lt;TD&gt;</code> in un foglio di stile, così la nostra calcolatrice si presenta meglio:
<p></p></p><pre class="xml">&lt;style&gt;
&#42;{
    font-family: sans-serif;
    font-weight: normal;
    font-size: 1.1em;
}
td{
    background-color: #ccc;
    padding: 10px 30px 10px 30px;
    border-radius: 0.2em;
    text-align: center;
    cursor: default;
}
#result{
    border-color: #000;
    border-width: 1px;
    border-style: solid;
    padding: 10px 30px 10px 30px;
    text-align: right;
}
&lt;/style&gt;</pre>
<p><p></p>
<p></p>
<H1>Gestione degli eventi</H1>

Il prossimo passo è collegare un'azione alla pressione dei pulsanti della calcolatrice:
<p></p>
<ul>
<li> per numeri e operatori: stampa la cifra o operatore nel campo del risultato
<li> per =: esegui l'operazione e stampa il risultato, o un messaggio di errore se l'input non è valido
<li> per la lettera C: resetta il campo del risultato
</ul>
<p></p>
Per gestire gli elementi visibili nella pagina, il programma deve prima ottenerne un riferimento. I bottoni sono stati creati usando il tag <code>&lt;TD&gt;</code>; si può ottenere i riferimenti a questo tag con questa sintassi:
<p></p></p><pre class="python">document.select("td")</pre>
<p><p></p>
L'argomento passato al metodo <code>select()</code> è un <I>selettore CSS</I>. I più comuni sono: il nome di un tag ("td"), l'attributo <code>id</code> dell'elemento ("#result") o i suoi attributi di tipo "class" (".classname"). Il risultato di <code>select()</code> è sempre una lista di elementi.
<p></p>
Gli eventi che possono verificarsi su un elemento di una pagina hanno nomi normalizzati: quando l'utente clicca su un pulsante, l'evento "click" viene lanciato. Nel programma, questo evento causa l'esecuzione di una funzione. L'associazione tra elemento, evento e funzione si definisce con la seguente sintassi:
<p></p></p><pre class="python">elemento.bind("click", funzione)</pre>
<p><p></p>
Per la calcolatrice, possiamo associare la stessa funzione all'evento "click" su tutti i pulsanti:
<p></p></p><pre class="python">for button in document.select("td"):
    button.bind("click", action)</pre>
<p><p></p>
Per essere conformi con la sintassi Python la funzione <code>action()</code> deve essere definita nel programma prima dell'uso. Queste funzioni, denominate "callback", accettano un singolo parametro, un oggetto che rappresenta l'evento.
<p></p>
<p></p>
<H1>Il programma completo</H1>

Ecco il codice per gestire una calcolatrice minimale. La parte più importante è contenuta nella funzione <code>action(event)</code>.
<p></p></p><pre class="python">from browser import document, html

# Costruzione degli elementi della calcolatrice
calc = html.TABLE()
calc &lt;= html.TR(html.TH(html.DIV("0", id="result"), colspan=3) +
                html.TD("C"))
lines = ["789/", "456&#42;", "123-", "0.=+"]

calc &lt;= (html.TR(html.TD(x) for x in line) for line in lines)

document &lt;= calc

# accesso diretto al campo dei risultati usandone l'id
result = document["result"]

def action(event):
    """Handles the "click" event on a button of the calculator."""
    # L'elemento cliccato dall'utente è l'attributo "target"
    # dell'oggetto "event" che la funzione riceve
    element = event.target
    # L'attributo "text" dell'elemento contiene
    # il testo visibile sul pulsante
    value = element.text
    if value not in "=C":
        # Aggiorna il campo dei risultati
        if result.text in ["0", "error"]:
            result.text = value
        else:
            result.text = result.text + value
    elif value == "C":
        # Fa un reset
        result.text = "0"
    elif value == "=":
        # Esegue la formula scritta nel campo dei risultati
        try:
            result.text = eval(result.text)
        except:
            result.text = "error"

# Associa la funzione action() all'evento "click" per tutti i pulsanti
for button in document.select("td"):
    button.bind("click", action)</pre>
<p><p></p>
<p></p>
<H1>Risultato</H1>

<iframe width="800", height="400" src="/gallery/calculator.html"></iframe>
<p></p>
<p></p></p>
</div>

<div id="menu"></div>

</body>
</html>
