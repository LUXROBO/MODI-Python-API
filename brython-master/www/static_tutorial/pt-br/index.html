<!doctype html>
<html>
<head>
<meta name="description" content="Brython">
<meta name="keywords" content="Python,Brython">
<meta name="author" content="Pierre Quentel">
<meta charset="utf-8">

<style>
#content{
    float: right;
    width: 75%;
}
#menu{
    padding-left:1%;
    margin-right: 80%;
    position: fixed;
}
</style>

<link rel="icon" type="image/png" href="favicon.png" />

<noscript>Please enable Javascript to view this page correctly.</noscript>

<script type="text/javascript" src="/src/brython.js"></script>

<script src="/assets/header.brython.js"></script>


<script type="text/python3">
from browser import document, highlight, html
import html_parser
import header

tutorial_languages = header.languages.extend(
  [["br", "Brezhoneg"],
   ["it", "Italiano"],
   ["pt-br", "Portuguese (Br.)"]
  ])

qs_lang, language = header.show(tutorial_languages)

# Highlight Python code
for elt in document.get(selector='.python'):
    src = elt.text.strip()
    h = highlight.highlight(src)
    h.className = "pycode"
    elt.clear()
    elt <= h

# Generate menu
menu = document["menu"]
for i, tag in enumerate(document.select("H1")):
    menu <= html.A(tag.text, href=f"#item{i}") + html.BR()
    tag.parent.insertBefore(html.A(name=f"item{i}"), tag)
for elt in document.select('.xml'):
    text = elt.text
    elt.text = ""
    script = False
    for item in html_parser.tokenize(text):
        if item.nodeType == html_parser.TEXT_NODE and item.text:
            if script and item.text.strip():
                h = highlight.highlight(item.text.strip())
                h.style.margin = 0
                h.classList.add("pycode")
                h.style.display = "block"
                elt <= h
            else:
                elt <= item.text
        elif item.nodeType == html_parser.ELEMENT_NODE:
            script = item.tagName == "SCRIPT" and not item.closing
            if item.closing:
                tag = item.text[1:len(item.tagName) + 2]
                attrs = item.text[len(item.tagName) + 2:-1]
            else:
                tag = item.text[1:len(item.tagName) + 1]
                attrs = item.text[len(item.tagName) + 1:-1]

            elt <= (html.SPAN("&lt;" + tag, Class="html-tag") +
                    html.SPAN(attrs, Class="html-attrs") +
                    html.SPAN("&gt;", Class="html-tag"))
</script>

<title>Brython</title>
<link rel="stylesheet" href="/brython.css">
</head>

<body onload="brython(1)">

<div id="banner_row">
<span class="logo"><a href="/index.html">brython</a></span>
</div>


<div id="content">
<p>Esse tutorial explica como desenvolver uma aplicação que roda no browser usando a linguagem Python. No exemplo abaixo vamos escrever uma calculadora.  
<p></p>
Precisaremos de um editor de texto e um browser com acesso à Internet.
<p></p>
O conteúdo a seguir presume que você tenha conhecimentos básicos de HTML (como estrutura geral da página e tags mais usuais), de stylesheets (CSS) e da linguagem Python.
<p></p>
Em um editor de texto, crie um arquivo HTML com o seguinte conteúdo:
<p></p></p><pre class="xml">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/brython@3.9.1/brython.min.js"&gt;
    &lt;/script&gt;
&lt;/head&gt;

&lt;body onload="brython()"&gt;

&lt;script type="text/python"&gt;
    from browser import document

    document &lt;= "Hello !"
&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;</pre>
<p><p></p>
Em um diretório vazio salve o arquivo como <B><code>index.html</code></B>. Para abri-lo, você tem duas opções:
<p></p>
<ul>
<li> usar o menu File/Open do navegador: é a solução mais simples. Tem <a href="/static_doc/pt-br/file_or_http.html">certas limitações</a> para um uso avançado, mas funciona perfeitamente para este tutorial.
<li> iniciar um servidor web: por exemplo, se o interpretador Python baixado do python.org estiver instalado em seu computador, rode <code>python -m http.server</code> no diretório criado, após acesse <I>localhost:8000/index.html</I> no seu navegador.
</ul>
<p></p>
Quando você abrir a página, deverá ver a mensagem "Hello !" exibida na janela do navegador.
<p></p>
<p></p>
<H1>Estrutra da página</H1>

Vamos dar uma olhada no conteúdo da página. Na seção HTML <code>&lt;head&gt;</code>, nós carregamos o script <B><code>brython.js</code></B>, que é biblioteca Brython que encontrará e executará os scripts Python incluídos na página. Neste exemplo nós usamos o script armazenado no CDN, desta forma não precisamos instalar nada localmente. A versão (<code>brython@3.9.1</code>) pode ser atualizada para cada nova versão do Brython.
<p></p>
A tag <code>&lt;body&gt;</code> tem um atributo <code>onload="brython()"</code>. Isso significa que quando a página tiver carregado todo conteúdo, o browser chamará a função <code>brython()</code>, que está definido na biblioteca Brython já carregada na página. Essa função busca por todas as tags <code>&lt;script&gt;</code> que contêm o atributo <code>type="text/python"</code> e executa o código contido nelas.
<p></p>
Nossa página <B><code>index.html</code></B> contem esse script:
<p></p></p><pre class="python">from browser import document

document &lt;= "Hello !"</pre>
<p><p></p>
É um programa Python padrão, sendo importado pelo módulo <B><code>browser</code></B> (neste caso, o módulo está contido na biblioteca Brython <B><code>brython.js</code></B>). O módulo tem um atributo <code>document</code> que referencia o conteúdo exibido na janela do navegador
<p></p>
Para adicionar um texto ao documento - especificamente, para exibir um texto no browser - a sintaxe usada pelo Brython é:
<p></p></p><pre class="python">document &lt;= "Hello !"</pre>
<p><p></p>
Você pode ver o operador <code>&lt;=</code> como uma seta apontando para esquerda: o document "recebe" um novo elemento, neste caso recebe a string "Hello !". Você verá a seguir que sempre é possível usar a forma padrão da sintaxe DOM para interagir com a página, 
<p></p>
Para este exemplo, você também pode usar o método <code>attach</code> ao invés do operador <code>&lt;=</code>:
<p></p></p><pre class="python">document.attach("Hello !")</pre>
<p><p></p>
<p></p>
<H1>Formatando textos com tags HTML</H1>

Tags HTML permitem a formatação de texto, por exemplo, para escrevê-lo em negrito <code>&lt;B&gt;</code>, em itálico <code>&lt;I&gt;</code>, etc.
<p></p>
Usando o Brython, essas tags são acessível como as funções definidas no módulo <B><code>html</code></B> do pacote <B><code>browser</code></B>. Segue exemplo de como usá-las:
<p></p></p><pre class="python">from browser import document, html

document &lt;= html.B("Hello !")</pre>
<p><p></p>
As tags podem ser aninhadas:
<p></p></p><pre class="python">document &lt;= html.B(html.I("Hello !"))</pre>
<p><p></p>
As tags também podem ser adicionadas umas às outras, bem como strings:
<p></p></p><pre class="python">document &lt;= html.B("Hello, ") + "world !"</pre>
<p><p></p>
O primeiro argumento de uma função tag pode ser uma string, um número, outra tag. Também pode ser um "iterável" Python (list, comprehension, generator): neste caso, todos os elementos produzidos na iteração são adicionados à tag:
<p></p></p><pre class="python">document &lt;= html.UL(html.LI(i) for i in range(5))</pre>
<p><p></p>
Os atributos da tag são passados ​​como keyword arguments para a função:
<p></p></p><pre class="python">html.A("Brython", href="http://brython.info")</pre>
<p><p></p>
<p></p>
<H1>Desenhando a calculadora</H1>

Podemos desenhar nossa calculadora como uma table HTML.
<p></p>
A primeira linha é feita da zona de resultado, seguida por um botão de reset. As próximas 3 linhas contêm os dígitos e operadores matemáticos.
<p></p></p><pre class="python">from browser import document, html

calc = html.TABLE()
calc &lt;= html.TR(html.TH(html.DIV("0", id="result"), colspan=3) +
                html.TD("C", id="clear"))
lines = ["789/",
         "456&#42;",
         "123-",
         "0.=+"]

calc &lt;= (html.TR(html.TD(x) for x in line) for line in lines)

document &lt;= calc</pre>
<p><p></p>
Observe o uso de Python generators para reduzir a quantidade de código, mantendo-o legível.
<p></p>
Vamos adicionar estilo às tags <code>&lt;TD&gt;</code> em uma stylesheet para que a calculadora tenha uma aparência melhor:
<p></p></p><pre class="xml">&lt;style&gt;
&#42;{
    font-family: sans-serif;
    font-weight: normal;
    font-size: 1.1em;
}
td{
    background-color: #ccc;
    padding: 10px 30px 10px 30px;
    border-radius: 0.2em;
    text-align: center;
    cursor: default;
}
#result{
    border-color: #000;
    border-width: 1px;
    border-style: solid;
    padding: 10px 30px 10px 30px;
    text-align: right;
}
&lt;/style&gt;</pre>
<p><p></p>
<p></p>
<H1>Tratamento de eventos</H1>

A próxima etapa é disparar uma ação quando o usuário pressiona a calculadora:
<p></p>
<ul>
<li> para digitos e operações :  imprima o dígito ou operação na zona de resultado
<li> para o sinal = : execute a operação e imprima o resultado, ou uma mensagem de erro se a entrada for inválida
<li> para a letra C: redefina a zona de resultado
</ul>
<p></p>
Para lidar com os elementos exibidos na página, o programa precisa primeiro obter uma referência a eles. Os botões foram criados como tags <code>&lt;TD&gt;</code>; para obter uma referência a todas essas tags, a sintaxe é
<p></p></p><pre class="python">document.select("td")</pre>
<p><p></p>
O argumento passado para o método <code>select()</code> é um seletor CSS. Os mais usuais são: um nome de tag ("td"), o atributo <code>id</code> do elemento ("#result") ou seu atributo "class" (".classname"). O resultado do <code>select()</code> é sempre uma lista de elementos.
<p></p>
Os eventos que podem ocorrer nos elementos de uma página têm um nome normalizado: quando o usuário clica em um botão, o evento denominado "click" é acionado. No programa, este evento provoca a execução de uma função. A associação entre elemento, evento e função é definida pela sintaxe
<p></p></p><pre class="python">element.bind("click", action)</pre>
<p><p></p>
Para a calculadora, podemos associar a mesma função ao evento "click" em todos os botões:
<p></p></p><pre class="python">for button in document.select("td"):
    button.bind("click", action)</pre>
<p><p></p>
Para ser compatível com a sintaxe Python, a função <code>action()</code> precisa ter sido definida em algum lugar antes no programa. Essas funções "callback" (retorno de chamada) usam um único parâmetro, um objeto que representa o evento.
<p></p>
<p></p>
<H1>Programa Completo</H1>

Aqui está o código que gerencia uma versão mínima da calculadora. A parte mais importante está na ação da função <code>action(event)</code>.
<p></p></p><pre class="python">from browser import document, html

# construção da calculadora
calc = html.TABLE()
calc &lt;= html.TR(html.TH(html.DIV("0", id="result"), colspan=3) +
                html.TD("C"))
lines = ["789/", "456&#42;", "123-", "0.=+"]

calc &lt;= (html.TR(html.TD(x) for x in line) for line in lines)

document &lt;= calc

result = document["result"]  # acesso direto a um elemento por seu id

def action(event):
    """Lida com o evento "click" em um botão da calculadora."""
    # O elemento em que o usuário clicou é o atributo "target" (alvo)
    # do objeto de evento
    element = event.target
    # O texto impresso no botão é o atributo "text" do elemento
    value = element.text
    if value not in "=C":
        # atualizando a zona de resultado
        if result.text in ["0", "error"]:
            result.text = value
        else:
            result.text = result.text + value
    elif value == "C":
        # redefinindo
        result.text = "0"
    elif value == "=":
        # execute a fórmula na zona de resultado
        try:
            result.text = eval(result.text)
        except:
            result.text = "error"

# Associe a função action() ao evento "click" em todos os botões
for button in document.select("td"):
    button.bind("click", action)</pre>
<p><p></p>
<p></p>
<H1>Resultado</H1>

<iframe width="800", height="400" src="/gallery/calculator.html"></iframe>
<p></p>
<p></p></p>
</div>

<div id="menu"></div>

</body>
</html>
