<!doctype html>
<html>
<head>
<meta name="description" content="Brython">
<meta name="keywords" content="Python,Brython">
<meta name="author" content="Pierre Quentel">
<meta charset="utf-8">

<style>
#content{
    float: right;
    width: 75%;
}
#menu{
    padding-left:1%;
    margin-right: 80%;
    position: fixed;
}
</style>

<link rel="icon" type="image/png" href="favicon.png" />

<noscript>Please enable Javascript to view this page correctly.</noscript>

<script type="text/javascript" src="/src/brython.js"></script>

<script src="/assets/header.brython.js"></script>


<script type="text/python3">
from browser import document, highlight, html
import html_parser
import header

tutorial_languages = header.languages.extend(
  [["br", "Brezhoneg"],
   ["it", "Italiano"],
   ["pt-br", "Portuguese (Br.)"]
  ])

qs_lang, language = header.show(tutorial_languages)

# Highlight Python code
for elt in document.get(selector='.python'):
    src = elt.text.strip()
    h = highlight.highlight(src)
    h.className = "pycode"
    elt.clear()
    elt <= h

# Generate menu
menu = document["menu"]
for i, tag in enumerate(document.select("H1")):
    menu <= html.A(tag.text, href=f"#item{i}") + html.BR()
    tag.parent.insertBefore(html.A(name=f"item{i}"), tag)
for elt in document.select('.xml'):
    text = elt.text
    elt.text = ""
    script = False
    for item in html_parser.tokenize(text):
        if item.nodeType == html_parser.TEXT_NODE and item.text:
            if script and item.text.strip():
                h = highlight.highlight(item.text.strip())
                h.style.margin = 0
                h.classList.add("pycode")
                h.style.display = "block"
                elt <= h
            else:
                elt <= item.text
        elif item.nodeType == html_parser.ELEMENT_NODE:
            script = item.tagName == "SCRIPT" and not item.closing
            if item.closing:
                tag = item.text[1:len(item.tagName) + 2]
                attrs = item.text[len(item.tagName) + 2:-1]
            else:
                tag = item.text[1:len(item.tagName) + 1]
                attrs = item.text[len(item.tagName) + 1:-1]

            elt <= (html.SPAN("&lt;" + tag, Class="html-tag") +
                    html.SPAN(attrs, Class="html-attrs") +
                    html.SPAN("&gt;", Class="html-tag"))
</script>

<title>Brython</title>
<link rel="stylesheet" href="/brython.css">
</head>

<body onload="brython(1)">

<div id="banner_row">
<span class="logo"><a href="/index.html">brython</a></span>
</div>


<div id="content">
<p>Este tutorial explica como desarrollar una aplicación que se ejecuta en el navegador usando el lenguaje de programación Python. Usaremos el ejemplo de crear una calculadora.
<p></p>
Necesitarás un editor de texto y, por supuesto, un navegador con acceso a internet.
<p></p>
Los contenidos de este tutorial asume que dispones de conocimientos basicos de HTML (estructura general de la página, las etiquetas más usadas), de hojas de estilos (CSS) y del lenguaje Python.
<p></p>
En el editor de texto crea una página HTML con el siguiente contenido:
<p></p></p><pre class="xml">&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/brython@3.9.1/brython.min.js"&gt;
    &lt;/script&gt;
&lt;/head&gt;

&lt;body onload="brython()"&gt;

&lt;script type="text/python"&gt;
from browser import document

document &lt;= "Hola !"
&lt;/script&gt;


&lt;/body&gt;

&lt;/html&gt;</pre>
<p><p></p>
Guarda la página en un directorio vacio con el nombre <B><code>index.html</code></B>. Para verlo en el navegador dispones de varias opciones:
<p></p>
<ul>
<li> usa el menú File/Open del navegador: es la solución más simple. Tiene ciertas limitaciones <a href="/static_doc/en/file_or_http.html">ciertas limitaciones</a> para un uso más avanzado pero esta opción funcionará sin problemas para poder llevar este tutorial a cabo.
<li> lanza un servidor web : por ejemplo, si el intérprete de Python que se descarga del site python.org está instalado en el equipo, ejecuta <code>python -m http.server</code> en el directorio donde hemos guardado el fichero. Luego puedes introducir <I>localhost:8000/index.html</I> en la barra de direcciones del navegador (para esta opción SÍ que te hará falta tener instalado un intérprete de CPython).
</ul>
<p></p>
Cuando abras la página deberías ver el mensaje "Hola !" mostrado en la ventana del navegador.
<p></p>
<p></p>
<H1>Estructura de la página</H1>

Echemos un vistazo a los contenidos de la página. En la zona del <code>&lt;head&gt;</code> llamamos al script <B><code>brython.js</code></B> : Es la biblioteca Brython, el programa que encontrará y ejecutará los scripts Python incluidos en la página. En este ejemplo obtenemos la biblioteca usando un CDN de tal forma que no hace falta instalar nada en el PC. El número de versión (<code>brython@3.9.1</code>) se puede actualizar para cada nueva versión de Brython.
<p></p>
La etiqueta <code>&lt;body&gt;</code> contiene el atributo <code>onload="brython()"</code>. Significa que cuando la página termine de cargarse el navegador llamará a la función <code>brython()</code>, la cual está definida en la biblioteca Brython ya cargada en la página. La función busca todas las etiquetas <code>&lt;script&gt;</code> que contienen el atributo <code>type="text/python"</code> y ejecuta el código contenido en ellas.
<p></p>
Nuestra página <B><code>index.html</code></B> contiene este script:
<p></p></p><pre class="python">from browser import document

document &lt;= "Hello !"</pre>
<p><p></p>
Este es un programa Python estándar, empezando por la importación del módulo <B><code>browser</code></B> (en este caso, un módulo contenido con la biblioteca Brython <B><code>brython.js</code></B>). El módulo contiene un atributo <code>document</code> que referencia al contenido mostrado en la ventana del navegador.
<p></p>
Para añadir un texto al documento - concretamente, para mostrar texto en el navegador - la sintaxis usada por Brython es
<p></p></p><pre class="python">document &lt;= "Hello !"</pre>
<p><p></p>
Puedes ver el operador <code>&lt;=</code> como una flecha apuntando a la izquierda : el documento 'recibe' un nuevo elemento, en este caso el texto "Hello !". Verás en la página de ejemplo que siempre se posible usar la forma estándar de la sintaxis del DOM para interactuar con la página. Pero Brython proporciona unos pocos atajos para que el código sea más corto.
<p></p>
<p></p>
<H1>Formateado de texto con etiquetas HTML</H1>

Las etiquetas HTML permiten formatear el texto para escribirlo, por ejemplo, en negrita (etiqueta <code>&lt;B&gt;</code>), en cursiva (<code>&lt;I&gt;</code>), etc.
<p></p>
Con Brython estas etiquetas están disponibles como funciones definidas en el modulo <B><code>html</code></B> del paquete <B><code>browser</code></B>. Aquí puedes ver cómo usarlo:
<p></p></p><pre class="python">from browser import document, html

document &lt;= html.B("Hola !")</pre>
<p><p></p>
Se pueden anidar las etiquetas:
<p></p></p><pre class="python">document &lt;= html.B(html.I("Hola !"))</pre>
<p><p></p>
Las etiquetas se pueden añadir unas a otras como <I>strings</I>:
<p></p></p><pre class="python">document &lt;= html.B("Hola, ") + "mundo !"</pre>
<p><p></p>
El primer argumento de la función de etiqueta HTML puede ser un <I>string</I>, un número, otra etiqueta. Puede ser, también, un "iterable" Python (list, comprehension, generador): en este caso, todos los elementos creados en la iteración se añaden a la etiqueta.
<p></p></p><pre class="python">document &lt;= html.UL(html.LI(i) for i in range(5))</pre>
<p><p></p>
Los atributos de una etiqueta se pueden mandar a la etiqueta usando palabras clave en la función:
<p></p></p><pre class="python">html.A("Brython", href="http://brython.info")</pre>
<p><p></p>
<p></p>
<H1>Dibujando la calculadora</H1>

Podemos dibujar nuestra calculadora como una tabla HTML.
<p></p>
La primera línea contendrá la zona de resultados seguida de un botón de reseteo. Las siguientes tres líneas contienen los dígitos, operaciones,...
<p></p></p><pre class="python">from browser import document, html

calc = html.TABLE()
calc &lt;= html.TR(html.TH(html.DIV("0", id="result"), colspan=3) +
                html.TD("C", id="clear"))
lines = ["789/",
         "456&#42;",
         "123-",
         "0.=+"]

calc &lt;= (html.TR(html.TD(x) for x in line) for line in lines)

document &lt;= calc</pre>
<p><p></p>
Estamos usando generadores Python para que el tamaño del programa sea más pequeño pero siga siendo legible.
<p></p>
Vamos a añadir estilo a las etiquetas <code>&lt;TD&gt;</code> en una hoja de estilos de tal forma que la calculadora tenga mejor aspecto visual:
<p></p></p><pre class="xml">&lt;style&gt;
&#42;{
    font-family: sans-serif;
    font-weight: normal;
    font-size: 1.1em;
}
td{
    background-color: #ccc;
    padding: 10px 30px 10px 30px;
    border-radius: 0.2em;
    text-align: center;
    cursor: default;
}
#result{
    border-color: #000;
    border-width: 1px;
    border-style: solid;
    padding: 10px 30px 10px 30px;
    text-align: right;
}
&lt;/style&gt;</pre>
<p><p></p>
<p></p>
<H1>Gestión de eventos</H1>

El siguiente paso será desencadenar una acción cuando el usuario presione los botones de la calculadora:
<p></p>
<ul>
<li> Para los dígitos y las operaciones : Muestra el dígito o la operación en la zona de resultados.
<li> Para el signo = : ejecuta la operación y muestra el resultado o un mensaje de error en el caso de que la entrada sea inválida.
<li> Para la letra C : resetea la zona de resultados.
</ul>
<p></p>
Para manejar los elementos mostrados en la página el programa necesitará primero obtener una referencia a esos elementos. Los botones han sido creados como etiquetas <code>&lt;TD&gt;</code>; la sintaxis para obtener una referencia a todas estas etiquetas será;
<p></p></p><pre class="python">document.select("td")</pre>
<p><p></p>
El argumento usado en el método <code>select()</code> es un <I>CSS selector</I>. Los más típicos son: un nombre de etiqueta ("td"), el atributo <code>id</code> del elemento ("#result") o su atributo "class" (".classname"). El resultado de <code>select()</code> será siempre una lista de elementos.
<p></p>
Los eventos que pueden ocurrir en los elementos de una página tienen un nombre normalizado: cuando el usuario pulsa en un botón, el evento llamado "click" sucede. Enel programa, este evento provocará la ejecución de una función. La asociación entre elemento, evento y función se define usando la siguiente sintaxis
<p></p></p><pre class="python">element.bind("click", action)</pre>
<p><p></p>
Para la calculadora, podemos asociar la misma función a los eventos "click" de todos los botones mediante:
<p></p></p><pre class="python">for button in document.select("td"):
    button.bind("click", action)</pre>
<p><p></p>
Para que cumpla con la sintaxis Python, la función <code>action()</code> debe estar definida en algún lugar previo del programa. Estas funciones "callback" toman un único parámetro, un objeto que representa el evento.
<p></p>
<p></p>
<H1>Programa completo</H1>

Aquí está el código con una versión minima de la calculadora. La parte más importante es la función <code>action(event)</code>.
<p></p></p><pre class="python">from browser import document, html

# Construction de la calculatrice
calc = html.TABLE()
calc &lt;= html.TR(html.TH(html.DIV("0", id="result"), colspan=3) +
                html.TD("C"))
lines = ["789/", "456&#42;", "123-", "0.=+"]

calc &lt;= (html.TR(html.TD(x) for x in line) for line in lines)

document &lt;= calc

result = document["result"] # acceso directo a un elemento mediante su id

def action(event):
    """Gestiona el evento "click" en un botón de la calculadora."""
    # El elemento pulsado por el usuario es el atributo "target" del
    # objeto event
    element = event.target
    # El texto mostrado en el botón es el atributo "text" del elemento
    value = element.text
    if value not in "=C":
        # actualiza la zona de resultados
        if result.text in ["0", "error"]:
            result.text = value
        else:
            result.text = result.text + value
    elif value == "C":
        # reset
        result.text = "0"
    elif value == "=":
        # ejecuta la fórmula en la zona de resultados
        try:
            result.text = eval(result.text)
        except:
            result.text = "error"

# Asocia la función action() al evento "click" en todos los botones
for button in document.select("td"):
    button.bind("click", action)</pre>
<p><p></p>
<p></p>
<H1>Resultado</H1>

<iframe width="800", height="400" src="/gallery/calculator.html"></iframe>
<p></p>
<p></p></p>
</div>

<div id="menu"></div>

</body>
</html>
